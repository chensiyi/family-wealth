<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>家族财富管理系统 - 本地测试版</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #ecf0f1;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .card-header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
        }
        
        .stat-card {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border: none;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border: none;
        }
        
        .news-item {
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin-bottom: 15px;
            background: white;
            padding: 15px;
            border-radius: 0 5px 5px 0;
        }
        
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
        }
    </style>
</head>
<body>
    <div class="header text-center">
        <h1><i class="fas fa-chart-line me-3"></i>家族财富管理系统</h1>
        <p class="lead">交互式投资组合管理与分析平台</p>
    </div>

    <div class="container">
        <!-- 统计概览 -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-number" id="totalValue">¥1,105,000</div>
                    <div class="text-muted">总资产</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-number" id="cashBalance">¥870,200</div>
                    <div class="text-muted">现金余额</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-number text-success" id="unrealizedPnl">¥3,008</div>
                    <div class="text-muted">未实现盈亏</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-number" id="positionCount">2</div>
                    <div class="text-muted">持仓数量</div>
                </div>
            </div>
        </div>

        <!-- 主要功能区域 -->
        <div class="row">
            <!-- 持仓管理 -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-wallet me-2"></i>持仓明细
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>股票代码</th>
                                        <th>持仓数量</th>
                                        <th>成本价</th>
                                        <th>当前价</th>
                                        <th>市值</th>
                                        <th>盈亏</th>
                                        <th>盈亏率</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="positionsTable">
                                    <tr>
                                        <td>
                                            <strong>NVDA</strong><br>
                                            <small class="text-muted">英伟达</small>
                                        </td>
                                        <td>100</td>
                                        <td>¥850.00</td>
                                        <td>¥875.28</td>
                                        <td>¥87,528</td>
                                        <td class="text-success">¥2,528</td>
                                        <td class="text-success">2.97%</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary me-1" onclick="showDetail('NVDA')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="prepareSell('NVDA')">
                                                <i class="fas fa-arrow-down"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>JNJ</strong><br>
                                            <small class="text-muted">强生</small>
                                        </td>
                                        <td>200</td>
                                        <td>¥150.00</td>
                                        <td>¥152.40</td>
                                        <td>¥30,480</td>
                                        <td class="text-success">¥480</td>
                                        <td class="text-success">1.60%</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary me-1" onclick="showDetail('JNJ')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="prepareSell('JNJ')">
                                                <i class="fas fa-arrow-down"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 交易操作 -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-exchange-alt me-2"></i>快速交易
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">股票代码</label>
                            <input type="text" class="form-control" id="stockSymbol" placeholder="例如: AAPL">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">交易类型</label>
                            <select class="form-control" id="tradeType">
                                <option value="buy">买入</option>
                                <option value="sell">卖出</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">数量</label>
                            <input type="number" class="form-control" id="tradeQuantity" placeholder="交易数量">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">价格</label>
                            <input type="number" class="form-control" id="tradePrice" placeholder="交易价格" step="0.01">
                        </div>
                        <button class="btn btn-primary w-100" onclick="executeTrade()">
                            <i class="fas fa-bolt me-2"></i>执行交易
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 新闻资讯 -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-newspaper me-2"></i>最新资讯
                        <button class="btn btn-sm btn-light float-end" onclick="refreshNews()">
                            <i class="fas fa-sync-alt me-1"></i>刷新
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="newsContainer">
                            <div class="news-item">
                                <h6>英伟达发布新一代AI芯片，性能提升3倍</h6>
                                <p class="text-muted">科技行业迎来重大技术突破，相关概念股值得关注。英伟达新一代AI芯片采用先进工艺制程，在计算性能方面实现显著提升。</p>
                                <div class="d-flex justify-content-between">
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>2024-02-11
                                        <i class="fas fa-newspaper ms-2 me-1"></i>财经网
                                    </small>
                                    <small class="text-success">
                                        <i class="fas fa-bolt me-1"></i>影响力: 85%
                                    </small>
                                </div>
                            </div>
                            
                            <div class="news-item">
                                <h6>国际油价突破每桶90美元关口</h6>
                                <p class="text-muted">能源市场波动加剧，投资者需密切关注政策变化。受地缘政治因素影响，国际油价持续走高，相关能源股表现活跃。</p>
                                <div class="d-flex justify-content-between">
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>2024-02-11
                                        <i class="fas fa-newspaper ms-2 me-1"></i>华尔街日报
                                    </small>
                                    <small class="text-success">
                                        <i class="fas fa-bolt me-1"></i>影响力: 78%
                                    </small>
                                </div>
                            </div>
                            
                            <div class="news-item">
                                <h6>美联储暗示可能暂停加息周期</h6>
                                <p class="text-muted">金融市场流动性充裕，央行政策走向成为焦点。美联储最新会议纪要显示，官员们对通胀回落表示乐观，可能考虑暂停加息。</p>
                                <div class="d-flex justify-content-between">
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>2024-02-11
                                        <i class="fas fa-newspaper ms-2 me-1"></i>路透社
                                    </small>
                                    <small class="text-success">
                                        <i class="fas fa-bolt me-1"></i>影响力: 92%
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 风险分析 -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-shield-alt me-2"></i>风险指标
                    </div>
                    <div class="card-body">
                        <p><strong>夏普比率:</strong> <span class="text-success">1.25</span></p>
                        <p><strong>波动率:</strong> <span class="text-warning">15.8%</span></p>
                        <p><strong>最大回撤:</strong> <span class="text-danger">-8.3%</span></p>
                        <p><strong>总收益率:</strong> <span class="text-success">+12.6%</span></p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-search me-2"></i>股票推荐
                    </div>
                    <div class="card-body">
                        <div class="list-group">
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="mb-1">MSFT - 微软</h6>
                                        <p class="mb-1 text-muted small">云计算业务持续扩张，AI转型顺利</p>
                                    </div>
                                    <div class="text-end">
                                        <span class="badge bg-success">得分: 88%</span>
                                        <button class="btn btn-sm btn-outline-primary ms-2" onclick="quickBuy('MSFT')">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="mb-1">GOOGL - 谷歌</h6>
                                        <p class="mb-1 text-muted small">广告业务复苏明显，AI投资回报显现</p>
                                    </div>
                                    <div class="text-end">
                                        <span class="badge bg-success">得分: 82%</span>
                                        <button class="btn btn-sm btn-outline-primary ms-2" onclick="quickBuy('GOOGL')">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast通知 -->
    <div class="toast-notification" id="toastContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 家族财富管理系统核心逻辑
        class PortfolioSystem {
            constructor() {
                this.portfolio = {
                    cash: 1000000,
                    positions: {},
                    transactions: [],
                    history: []
                };
                this.loadPortfolio();
                this.initializeDemoData();
            }
            
            // 初始化演示数据
            initializeDemoData() {
                // NVDA持仓
                this.portfolio.positions['NVDA'] = {
                    symbol: 'NVDA',
                    name: '英伟达',
                    quantity: 100,
                    costBasis: 850.00,
                    currentPrice: 875.28,
                    marketValue: 87528,
                    unrealizedPnl: 2528,
                    unrealizedPnlPercent: 2.97
                };
                
                // JNJ持仓
                this.portfolio.positions['JNJ'] = {
                    symbol: 'JNJ',
                    name: '强生',
                    quantity: 200,
                    costBasis: 150.00,
                    currentPrice: 152.40,
                    marketValue: 30480,
                    unrealizedPnl: 480,
                    unrealizedPnlPercent: 1.60
                };
                
                this.updatePortfolioDisplay();
                this.startPriceSimulation();
            }
            
            // 执行交易
            executeTrade() {
                const symbol = document.getElementById('stockSymbol').value.toUpperCase();
                const type = document.getElementById('tradeType').value;
                const quantity = parseInt(document.getElementById('tradeQuantity').value);
                const price = parseFloat(document.getElementById('tradePrice').value);
                
                if (!symbol || !quantity || !price) {
                    this.showToast('请填写完整的交易信息', 'warning');
                    return;
                }
                
                if (type === 'buy') {
                    this.buyStock(symbol, quantity, price);
                } else {
                    this.sellStock(symbol, quantity, price);
                }
            }
            
            // 买入股票
            buyStock(symbol, quantity, price) {
                const totalCost = quantity * price + 10; // 加上手续费
                
                if (totalCost > this.portfolio.cash) {
                    this.showToast('资金不足，无法完成交易', 'danger');
                    return;
                }
                
                // 更新现金
                this.portfolio.cash -= totalCost;
                
                // 更新或创建持仓
                if (this.portfolio.positions[symbol]) {
                    const position = this.portfolio.positions[symbol];
                    const totalShares = position.quantity + quantity;
                    const totalCostBasis = (position.quantity * position.costBasis) + (quantity * price);
                    position.costBasis = totalCostBasis / totalShares;
                    position.quantity = totalShares;
                    position.currentPrice = price;
                } else {
                    this.portfolio.positions[symbol] = {
                        symbol: symbol,
                        name: this.getStockName(symbol),
                        quantity: quantity,
                        costBasis: price,
                        currentPrice: price,
                        marketValue: quantity * price,
                        unrealizedPnl: 0,
                        unrealizedPnlPercent: 0
                    };
                }
                
                // 记录交易
                this.portfolio.transactions.push({
                    id: Date.now(),
                    symbol: symbol,
                    type: 'BUY',
                    quantity: quantity,
                    price: price,
                    amount: -totalCost,
                    timestamp: new Date()
                });
                
                // 更新显示
                this.updatePortfolioDisplay();
                this.recordHistory();
                this.clearTradeForm();
                this.showToast(`买入 ${quantity} 股 ${symbol} @ ¥${price} 成功！`, 'success');
            }
            
            // 卖出股票
            sellStock(symbol, quantity, price) {
                const position = this.portfolio.positions[symbol];
                
                if (!position) {
                    this.showToast('该股票无持仓', 'danger');
                    return;
                }
                
                if (quantity > position.quantity) {
                    this.showToast('卖出数量超过持仓数量', 'danger');
                    return;
                }
                
                // 计算收入
                const proceeds = quantity * price - 10; // 扣除手续费
                this.portfolio.cash += proceeds;
                
                // 更新持仓
                position.quantity -= quantity;
                const realizedPnl = quantity * (price - position.costBasis);
                
                // 记录交易
                this.portfolio.transactions.push({
                    id: Date.now(),
                    symbol: symbol,
                    type: 'SELL',
                    quantity: quantity,
                    price: price,
                    amount: proceeds,
                    realizedPnl: realizedPnl,
                    timestamp: new Date()
                });
                
                // 如果持仓清空，移除该持仓
                if (position.quantity === 0) {
                    delete this.portfolio.positions[symbol];
                }
                
                // 更新显示
                this.updatePortfolioDisplay();
                this.recordHistory();
                this.clearTradeForm();
                this.showToast(`卖出 ${quantity} 股 ${symbol} @ ¥${price} 成功！实现盈亏: ¥${realizedPnl.toFixed(2)}`, 'success');
            }
            
            // 更新投资组合显示
            updatePortfolioDisplay() {
                // 更新统计卡片
                const positionsValue = Object.values(this.portfolio.positions)
                    .reduce((sum, pos) => sum + (pos.quantity * pos.currentPrice), 0);
                
                const totalValue = this.portfolio.cash + positionsValue;
                const unrealizedPnl = Object.values(this.portfolio.positions)
                    .reduce((sum, pos) => sum + ((pos.currentPrice - pos.costBasis) * pos.quantity), 0);
                
                document.getElementById('totalValue').textContent = `¥${totalValue.toLocaleString()}`;
                document.getElementById('cashBalance').textContent = `¥${this.portfolio.cash.toLocaleString()}`;
                document.getElementById('unrealizedPnl').textContent = `¥${unrealizedPnl.toLocaleString()}`;
                document.getElementById('positionCount').textContent = Object.keys(this.portfolio.positions).length;
                
                // 更新持仓表格
                this.updatePositionsTable();
            }
            
            // 更新持仓表格
            updatePositionsTable() {
                const tbody = document.getElementById('positionsTable');
                const positions = Object.values(this.portfolio.positions);
                
                if (positions.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="text-center">暂无持仓</td></tr>';
                    return;
                }
                
                tbody.innerHTML = positions.map(pos => {
                    const pnlClass = pos.unrealizedPnl >= 0 ? 'text-success' : 'text-danger';
                    const pnlPercentClass = pos.unrealizedPnlPercent >= 0 ? 'text-success' : 'text-danger';
                    
                    return `
                        <tr>
                            <td>
                                <strong>${pos.symbol}</strong><br>
                                <small class="text-muted">${pos.name}</small>
                            </td>
                            <td>${pos.quantity}</td>
                            <td>¥${pos.costBasis.toFixed(2)}</td>
                            <td>¥${pos.currentPrice.toFixed(2)}</td>
                            <td>¥${(pos.quantity * pos.currentPrice).toLocaleString()}</td>
                            <td class="${pnlClass}">¥${pos.unrealizedPnl.toLocaleString()}</td>
                            <td class="${pnlPercentClass}">${pos.unrealizedPnlPercent.toFixed(2)}%</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="portfolioSystem.showDetail('${pos.symbol}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="portfolioSystem.prepareSell('${pos.symbol}')">
                                    <i class="fas fa-arrow-down"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            // 准备卖出
            prepareSell(symbol) {
                document.getElementById('stockSymbol').value = symbol;
                document.getElementById('tradeType').value = 'sell';
                const position = this.portfolio.positions[symbol];
                if (position) {
                    document.getElementById('tradePrice').value = position.currentPrice.toFixed(2);
                }
                this.showToast(`已准备卖出 ${symbol}，请填写数量`, 'info');
            }
            
            // 显示详情
            showDetail(symbol) {
                const position = this.portfolio.positions[symbol];
                if (position) {
                    const detail = `
                        股票代码: ${position.symbol}
                        公司名称: ${position.name}
                        持仓数量: ${position.quantity}
                        成本价: ¥${position.costBasis.toFixed(2)}
                        当前价: ¥${position.currentPrice.toFixed(2)}
                        市值: ¥${(position.quantity * position.currentPrice).toLocaleString()}
                        未实现盈亏: ¥${position.unrealizedPnl.toLocaleString()}
                        盈亏率: ${position.unrealizedPnlPercent.toFixed(2)}%
                    `;
                    alert(detail);
                }
            }
            
            // 快速买入
            quickBuy(symbol) {
                document.getElementById('stockSymbol').value = symbol;
                document.getElementById('tradeType').value = 'buy';
                this.showToast(`已准备买入 ${symbol}，请填写数量和价格`, 'info');
            }
            
            // 清空交易表单
            clearTradeForm() {
                document.getElementById('stockSymbol').value = '';
                document.getElementById('tradeQuantity').value = '';
                document.getElementById('tradePrice').value = '';
            }
            
            // 记录历史
            recordHistory() {
                const positionsValue = Object.values(this.portfolio.positions)
                    .reduce((sum, pos) => sum + (pos.quantity * pos.currentPrice), 0);
                
                this.portfolio.history.push({
                    timestamp: new Date(),
                    cash: this.portfolio.cash,
                    positionsValue: positionsValue,
                    totalValue: this.portfolio.cash + positionsValue
                });
            }
            
            // 价格模拟
            startPriceSimulation() {
                setInterval(() => {
                    Object.values(this.portfolio.positions).forEach(position => {
                        // 随机价格波动 (-2% 到 +2%)
                        const changePercent = (Math.random() - 0.5) * 0.04;
                        position.currentPrice = position.currentPrice * (1 + changePercent);
                        position.currentPrice = Math.max(0.01, Math.round(position.currentPrice * 100) / 100);
                        
                        // 更新计算值
                        position.marketValue = position.quantity * position.currentPrice;
                        position.unrealizedPnl = (position.currentPrice - position.costBasis) * position.quantity;
                        position.unrealizedPnlPercent = ((position.currentPrice - position.costBasis) / position.costBasis) * 100;
                    });
                    
                    this.updatePortfolioDisplay();
                }, 5000);
            }
            
            // 获取股票名称
            getStockName(symbol) {
                const names = {
                    'NVDA': '英伟达',
                    'JNJ': '强生',
                    'MSFT': '微软',
                    'GOOGL': '谷歌',
                    'AAPL': '苹果',
                    'AMZN': '亚马逊',
                    'TSLA': '特斯拉'
                };
                return names[symbol] || symbol;
            }
            
            // 加载投资组合
            loadPortfolio() {
                const saved = localStorage.getItem('familyWealthPortfolio');
                if (saved) {
                    this.portfolio = JSON.parse(saved);
                }
            }
            
            // 保存投资组合
            savePortfolio() {
                localStorage.setItem('familyWealthPortfolio', JSON.stringify(this.portfolio));
            }
            
            // Toast通知
            showToast(message, type = 'info') {
                const container = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = 'alert alert-' + this.getAlertClass(type) + ' alert-dismissible fade show';
                toast.innerHTML = `
                    <i class="fas fa-${this.getAlertIcon(type)} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                container.appendChild(toast);
                
                // 3秒后自动关闭
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 3000);
            }
            
            getAlertClass(type) {
                const classes = {
                    'success': 'success',
                    'danger': 'danger',
                    'warning': 'warning',
                    'info': 'info'
                };
                return classes[type] || 'info';
            }
            
            getAlertIcon(type) {
                const icons = {
                    'success': 'check-circle',
                    'danger': 'exclamation-circle',
                    'warning': 'exclamation-triangle',
                    'info': 'info-circle'
                };
                return icons[type] || 'info-circle';
            }
        }
        
        // 初始化系统
        const portfolioSystem = new PortfolioSystem();
        
        // 全局函数绑定
        function executeTrade() {
            portfolioSystem.executeTrade();
        }
        
        function prepareSell(symbol) {
            portfolioSystem.prepareSell(symbol);
        }
        
        function showDetail(symbol) {
            portfolioSystem.showDetail(symbol);
        }
        
        function quickBuy(symbol) {
            portfolioSystem.quickBuy(symbol);
        }
        
        function refreshNews() {
            portfolioSystem.showToast('新闻已刷新', 'info');
        }
        

    </script>
</body>
</html>